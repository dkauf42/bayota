<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html;charset=utf-8">
  <title>TblSourceData.py</title>
  <link rel="stylesheet" href="pycco.css">
</head>
<body>
<div id='container'>
  <div id="background"></div>
  <div class='section'>
    <div class='docs'><h1>TblSourceData.py</h1></div>
  </div>
  <div class='clearall'>
  <div class='section' id='section-0'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-0'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">tables.ExcelDataTable</span> <span class="kn">import</span> <span class="n">ExcelDataTable</span>

<span class="n">srcdatadir</span> <span class="o">=</span> <span class="s1">&#39;/Users/Danny/Desktop/CATEGORIES/CAREER_MANAGEMENT/CRC_ResearchScientist_Optimization/&#39;</span> \
              <span class="s1">&#39;Optimization_Tool/2_ExperimentFolder/data_tables/source_and_base/2016progress/&#39;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-1'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-1'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">class</span> <span class="nc">SourceData</span><span class="p">(</span><span class="n">ExcelDataTable</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-2'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-2'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s1">&#39;SourceData.xlsx&#39;</span><span class="p">,</span> <span class="n">dirpath</span><span class="o">=</span><span class="n">srcdatadir</span><span class="p">):</span>

        <span class="n">sheet_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Geographic References&#39;</span><span class="p">,</span> <span class="s1">&#39;BMP Definitions&#39;</span><span class="p">,</span> <span class="s1">&#39;Efficiency BMPs&#39;</span><span class="p">,</span>
                       <span class="s1">&#39;Load Source Conversion BMPs&#39;</span><span class="p">,</span> <span class="s1">&#39;Load Reduction BMPs&#39;</span><span class="p">,</span>
                       <span class="s1">&#39;Animal BMPs&#39;</span><span class="p">,</span> <span class="s1">&#39;BMP Load Source Groups&#39;</span><span class="p">,</span> <span class="s1">&#39;Load Source Group Components&#39;</span><span class="p">,</span>
                       <span class="s1">&#39;Agencies&#39;</span><span class="p">,</span> <span class="s1">&#39;Load Source Definitions&#39;</span><span class="p">]</span>

        <span class="n">ExcelDataTable</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span> <span class="n">dirpath</span><span class="o">=</span><span class="n">dirpath</span><span class="p">,</span> <span class="n">sheet_names</span><span class="o">=</span><span class="n">sheet_names</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-3'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-3'>#</a>
      </div>
      <p>Data from excel sheets are saved to class attributes.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">georefs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">sheet_names</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bmpDefinitions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">sheet_names</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">efficiencyBMPs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">sheet_names</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sourceconversionBMPs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">sheet_names</span><span class="p">[</span><span class="mi">3</span><span class="p">]]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loadreductionBMPs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">sheet_names</span><span class="p">[</span><span class="mi">4</span><span class="p">]]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">animalBMPs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">sheet_names</span><span class="p">[</span><span class="mi">5</span><span class="p">]]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sourcegrps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">sheet_names</span><span class="p">[</span><span class="mi">6</span><span class="p">]]</span>  <span class="c1"># shows load source groups to which each bmp is applicable</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sourcegrpcomponents</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">sheet_names</span><span class="p">[</span><span class="mi">7</span><span class="p">]]</span>  <span class="c1"># shows load sources represented by each LS group</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">agencies</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">sheet_names</span><span class="p">[</span><span class="mi">8</span><span class="p">]]</span>  <span class="c1"># Columns of interest: &#39;AgencyCode&#39; and &#39;AgencyType&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lsdefinitions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">sheet_names</span><span class="p">[</span><span class="mi">9</span><span class="p">]]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">allbmps_shortnames</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_list_of_all_bmps</span><span class="p">()</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-4'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-4'>#</a>
      </div>
      <p>Don't use the list generated from the "BMP Definitions" sheet, i.e.</p>
<blockquote>
<blockquote>
<p>bmplist1 = self.bmpDefinitions['BMPShortName']
...because it is missing the following BMPs:
{'Biofilters', 'DairyPrecFeed', 'LitAmend', 'MTT19', 'AWMS', 'MTT18', 'ImperviousDisconnection', 'MTT5',
 'MTT11', 'MTT16', 'MTT4', 'MortalityComp', 'MTT1', 'MTT10', 'ManureTransport', 'MTT9', 'MTT14', 'MTT6',
 'CSOConnect', 'LagoonCovers', 'MTT7', 'MTT17', 'MTT13', 'MTT3', 'MTT12', 'MTT2', 'MTT15', 'MTT8'}</p>
</blockquote>
</blockquote>
<p>^ This was checked with the following code:</p>
<blockquote>
<blockquote>
<p>print(set(bmplist1).symmetric_difference(set(bmplist2)))</p>
</blockquote>
</blockquote>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">get_list_of_all_bmps</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-5'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-5'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">bmplist2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sourcegrps</span><span class="p">[</span><span class="s1">&#39;BmpShortName&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">bmplist2</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-6'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-6'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">getallnames</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nametype</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">nametype</span> <span class="o">==</span> <span class="s1">&#39;LandRiverSegment&#39;</span><span class="p">:</span>
            <span class="n">listofall</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">georefs</span><span class="p">[</span><span class="n">nametype</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">nametype</span> <span class="o">==</span> <span class="s1">&#39;CountyName&#39;</span><span class="p">:</span>
            <span class="n">listofall</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">georefs</span><span class="p">[</span><span class="n">nametype</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">nametype</span> <span class="o">==</span> <span class="s1">&#39;StateAbbreviation&#39;</span><span class="p">:</span>
            <span class="n">listofall</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">georefs</span><span class="p">[</span><span class="n">nametype</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">nametype</span> <span class="o">==</span> <span class="s1">&#39;StateBasin&#39;</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">nametype</span> <span class="o">==</span> <span class="s1">&#39;MajorBasin&#39;</span><span class="p">):</span>
            <span class="n">listofall</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">georefs</span><span class="p">[</span><span class="s1">&#39;MajorBasin&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">nametype</span> <span class="o">==</span> <span class="s1">&#39;AgencyCode&#39;</span><span class="p">:</span>
            <span class="n">listofall</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">agencies</span><span class="p">[</span><span class="n">nametype</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">nametype</span> <span class="o">==</span> <span class="s1">&#39;Sector&#39;</span><span class="p">:</span>
            <span class="n">listofall</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lsdefinitions</span><span class="p">[</span><span class="n">nametype</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Unrecognized nametype: &quot;</span><span class="si">%s</span><span class="s1">&quot;&#39;</span> <span class="o">%</span> <span class="n">nametype</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">listofall</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-7'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-7'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">findbmptype</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bmpshortname_orlist</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">bmpshortname_orlist</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">thesebmptypes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_singlebmptype</span><span class="p">(</span><span class="n">bmpshortname_orlist</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">bmpshortname_orlist</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">bmpshortname_orlist</span><span class="p">):</span>  <span class="c1"># check iterable for stringness of all items.</span>
                <span class="n">thesebmptypes</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">bmpshortname_orlist</span><span class="p">:</span>
                    <span class="n">thesebmptypes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_singlebmptype</span><span class="p">(</span><span class="n">item</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;unexpected type found in list&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;unexpected type&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">thesebmptypes</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-8'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-8'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">_singlebmptype</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bmpshortname</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
        <span class="n">bmptype</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">numtypes</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">bmpshortname</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">efficiencyBMPs</span><span class="p">[</span><span class="s1">&#39;BMPShortName&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">:</span>
            <span class="n">bmptype</span> <span class="o">=</span> <span class="s1">&#39;efficiency&#39;</span>
            <span class="n">numtypes</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">bmpshortname</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sourceconversionBMPs</span><span class="p">[</span><span class="s1">&#39;BMPShortName&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">:</span>
            <span class="n">bmptype</span> <span class="o">=</span> <span class="s1">&#39;sourceconversion&#39;</span>
            <span class="n">numtypes</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">bmpshortname</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">loadreductionBMPs</span><span class="p">[</span><span class="s1">&#39;BMPShortName&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">:</span>
            <span class="n">bmptype</span> <span class="o">=</span> <span class="s1">&#39;loadreduction&#39;</span>
            <span class="n">numtypes</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">bmpshortname</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">animalBMPs</span><span class="p">[</span><span class="s1">&#39;BMPShortName&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">:</span>
            <span class="n">bmptype</span> <span class="o">=</span> <span class="s1">&#39;animal&#39;</span>
            <span class="n">numtypes</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="n">numtypes</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">bmpshortname</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bmpDefinitions</span><span class="p">[</span><span class="s1">&#39;BMPShortName&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">:</span>
                <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bmpDefinitions</span>
                <span class="n">bmptype</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;BMPType&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">notnull</span><span class="p">()</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;BMPShortName&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">bmpshortname</span><span class="p">)][</span><span class="s1">&#39;BMPType&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">numtypes</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;No BMP type found for &quot;</span><span class="si">%s</span><span class="s1">&quot;&#39;</span> <span class="o">%</span> <span class="n">bmpshortname</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">numtypes</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;More than one BMP type found for &quot;</span><span class="si">%s</span><span class="s1">&quot;&#39;</span> <span class="o">%</span> <span class="n">bmpshortname</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">bmptype</span>

</pre></div>
    </div>
  </div>
  <div class='clearall'></div>
</div>
</body>
