#!/bin/bash

if [ $# -gt 0 ]; then
    STUDY=$1
else
    echo 'Usage: ./run_bayota.csh <study_name>'
    echo ''
    echo 'Enter name of the Study: '
    read STUDY
    INTERACTIVE=1
fi

SETTINGS_CONFIG_FILE=../../config/cloudfish/settings_config.cfg

echo ''
echo 'Locating SETTINGS Configuration File...'
if [ ! -f $SETTINGS_CONFIG_FILE ]; then
    echo 'Error'
    exit 1
fi

source ${SETTINGS_CONFIG_FILE}


# Define a timestamp function
timestamp() {
  date +"%Y%m%d-%H%M%S"
}
TIME_STAMP=timestamp
monthstamp() {
  date +"%Y%m"
}
MONTH_STAMP=monthstamp


# Directories to store Output and Logs
OUT_DIR=${OUTPUT_DIR_STEM}_${MONTH_STAMP}
mkdir -p $OUT_DIR

if [ -z ${PRIORITY} ]; then
    PRIORITY=5000
fi

echo 'Study: **' $STUDY '** in ' $PROJECT_HOME
echo 'Job Priority = ' $PRIORITY
echo ''
echo 'Continue? [Y/N]'
read response

if [ ${response} = 'Y' ] || [ ${response} = 'y' ]; then
    sbatch --nice=${PRIORITY} --job-name=${STUDY} ../bayota_efficiency.py

    iRETURN=$?

    if [ ${iRETURN} = 1 ]; then
        echo 'SLURM Unable to Queue'
    else
        echo ''
        echo 'Running'
        echo ''
    fi
fi